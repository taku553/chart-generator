# 開発者として無制限でアプリを使用する方法

このガイドでは、開発者がAIインサイトなどの有料機能を制限なく使用する方法を説明します。

## クイックスタート

### 方法1: 環境変数で設定（最も簡単）

1. `.env.local` ファイルを作成（または編集）

```bash
cp .env.example .env.local
```

2. 開発者モードと自分のメールアドレスを設定

```env
VITE_DEVELOPER_MODE=true
VITE_DEVELOPER_EMAILS=your-email@gmail.com
```

3. アプリを再起動

```bash
pnpm dev
```

4. 設定したメールアドレスでログイン

これだけで、AIインサイトなどの機能が無制限で使用できます！

---

### 方法2: Firestoreで直接設定

この方法は、環境変数を使わずにデータベースレベルで設定します。

#### 手動設定（Firebaseコンソール）

1. Firebaseコンソールを開く
   https://console.firebase.google.com/project/grafico-4dea6/firestore

2. `users` コレクションから自分のユーザーを探す

3. ドキュメントを編集して以下を設定:
   ```
   plan: "pro"
   isDeveloper: true
   ```

#### スクリプトで自動設定

1. `scripts/set-developer-role.js` を編集

```javascript
const DEVELOPER_EMAILS = [
  'your-email@gmail.com',  // ← あなたのメールアドレス
];
```

2. スクリプトを実行

```bash
node scripts/set-developer-role.js
```

---

## それぞれの方法の違い

| 方法 | 設定場所 | 再起動 | 本番影響 | おすすめ度 |
|------|---------|-------|---------|-----------|
| 環境変数 | `.env.local` | 必要 | なし | ⭐⭐⭐⭐⭐ |
| Firestore手動 | Firebaseコンソール | 不要 | 注意必要 | ⭐⭐⭐ |
| スクリプト | Firestore | 不要 | 注意必要 | ⭐⭐⭐⭐ |

### 環境変数方式（推奨）

**メリット:**
- ✅ 本番環境に影響しない（`.env.local`は本番にデプロイされない）
- ✅ チーム開発でも各自で設定可能
- ✅ セキュリティリスクが低い

**デメリット:**
- ⚠️ アプリの再起動が必要

### Firestore直接設定方式

**メリット:**
- ✅ アプリの再起動不要
- ✅ 即座に反映される

**デメリット:**
- ⚠️ 本番環境のデータベースで行うとリスクあり
- ⚠️ 環境を間違えないよう注意が必要

---

## 開発環境と本番環境の棲み分け

### 推奨構成

```
開発用プロジェクト（現在）
├── Firebase: grafico-4dea6
├── Stripe: テストモード
└── 開発者アカウント: 無制限で使用
    └── 環境変数 or Firestore で pro 設定

本番用プロジェクト（将来）
├── Firebase: grafico-production（新規作成）
├── Stripe: 本番モード
└── 実際のユーザー: 有料課金
```

### 本番環境を作成する際の注意点

1. **新しいFirebaseプロジェクトを作成**
   - プロジェクト名: `grafico-production`
   - 開発用とは完全に分離

2. **環境変数から開発者設定を削除**
   ```env
   # .env.production
   VITE_DEVELOPER_MODE=false
   # VITE_DEVELOPER_EMAILS は設定しない
   ```

3. **Stripeを本番モードに切り替え**
   - 本番用のAPIキーを使用
   - Webhookも本番用のURLを設定

---

## セキュリティチェックリスト

本番環境にデプロイする前に、以下を確認してください：

- [ ] `.env.production` に開発者メールアドレスが含まれていない
- [ ] `VITE_DEVELOPER_MODE` が `false` または未設定
- [ ] Stripeのシークレットキーが `.gitignore` に含まれている
- [ ] `.env.local` がGitにコミットされていない
- [ ] ソースコードに開発者メールアドレスがハードコードされていない

---

## トラブルシューティング

### Q: 環境変数を設定したのに開発者モードが有効にならない

A: 以下を確認してください：

1. アプリを再起動しましたか？
   ```bash
   # 一度停止して
   Ctrl + C
   # 再度起動
   pnpm dev
   ```

2. ファイル名は `.env.local` ですか？（`.env`ではない）

3. メールアドレスは正確ですか？（スペースなど余分な文字がないか）

4. 設定したメールアドレスでログインしていますか？

### Q: Firestoreで設定したのに反映されない

A: 以下を試してください：

1. 一度ログアウトして再ログイン

2. ブラウザのキャッシュをクリア

3. Firebaseコンソールでユーザードキュメントを再確認
   - `plan` フィールドが `"pro"` になっているか
   - タイポがないか

### Q: 本番環境でも開発者モードが有効になってしまう

A: 緊急対応：

1. `.env.production` を確認
   ```env
   VITE_DEVELOPER_MODE=false
   ```

2. 再ビルド＆デプロイ
   ```bash
   pnpm build
   vercel --prod
   ```

3. それでもダメなら `src/lib/developerUtils.js` を一時的に修正
   ```javascript
   export const isDeveloper = (email) => {
     return false; // 強制的に無効化
   };
   ```

---

## 複数の開発者がいる場合

チームで開発している場合は、各開発者が自分の `.env.local` を設定します。

```env
# 開発者A の .env.local
VITE_DEVELOPER_EMAILS=developer-a@company.com

# 開発者B の .env.local
VITE_DEVELOPER_EMAILS=developer-b@company.com
```

または、全員のメールアドレスをカンマ区切りで設定：

```env
VITE_DEVELOPER_EMAILS=dev-a@company.com,dev-b@company.com,dev-c@company.com
```

---

## まとめ

開発者として無制限でアプリを使用するには：

1. **最も簡単**: `.env.local` に自分のメールアドレスを設定
2. **即座に反映**: Firestoreで直接 `plan: "pro"` を設定
3. **本番環境では**: 開発者設定を削除して通常ユーザーと同じ扱いに

これで、AIインサイトなどの機能を制限なく使いながら開発できます！🎉
